<!DOCTYPE html>
<html>
<head>
	<title>Word Cards</title>
	<meta http-equiv='Content-Type' content='text/html'; charset='UTF-8'>
	<meta name='viewport' content='width=device-width, initial-scale=1.0'>
	<meta name='theme-color' content='#999999'>
	<meta name='Description' content='About: Flashcard quiz thing for babby, Author:Tristan Curry, Megan Curry'>
	<link rel='manifest' href='manifest.json' />
	<link rel='stylesheet' type='text/css' href='css/styles.css'/>
</head>

<body>
	<script type='text/javascript' src='scripts/swHandling.js'></script>

	<div onclick='void(0);'>
		<div class='update'>update ready!<button id='updateBtn'>UPDATE</button></div>
		<div class='solutions'></div>
	</div>

<script type="text/javascript">

const skinCodes = [
	'',
	'🏻',
	'🏼',
	'🏽',
	'🏾',
	'🏿',
];

const genderCodes = [
	'👨',
	'👩',
];

const hairCodes = [
'',
'🦰',
'🦱',
'🦳',
'🦲',
];

const wordbase = [
	{word: 'ant', syl: 1, char: '🐜'},
	{word: 'cat', syl: 1, char: '🐈'},
	{word: 'baby', syl: 2, char: '👶', skin: true},
	{word: 'cow', syl: 1, char: '🐄'},
	{word: 'bird', syl: 1, char: '🐦'},
	{word: 'crab', syl: 1, char: '🦀'},
	{word: 'bee', syl: 1, char: '🐝'},
	{word: 'apple', syl: 2, char: '🍎'},
	{word: 'banana', syl: 3, char: '🍌'},
	{word: 'car', syl: 1, char: '🚗'},
	{word: 'plane', syl: 1, char: '✈️'},
	{word: 'astronaut', syl: 3, char: '&zwj;🚀', skin: true, gender: true},
]

const chooseRandomFeature = featureList => {
	let selection = Math.floor((featureList.length)*Math.random());
	if (selection == featureList.length) {selection = featureList.length - 1};
	return featureList[selection];
}

const modifyCharString = wordInfo => {
	let foreChar = '';
	let aftChar = '';
	if(wordInfo.gender){
		foreChar += chooseRandomFeature(genderCodes);
	}
	if(wordInfo.skin){
		if(wordInfo.gender){
			foreChar += chooseRandomFeature(skinCodes);
		} else {
			aftChar += chooseRandomFeature(skinCodes);
		}
	}
	if(wordInfo.hair){
		aftChar += `&zwj;${chooseRandomFeature(hairCodes)}`;
	}

	return (foreChar + wordInfo.char + aftChar);
}

const findWordInfo = (word, wb) => {
	return new Promise ((resolve, reject) => {
		if(word) {
		let wordInfo = wb.find(entry => entry.word.toLowerCase() == word.toLowerCase());
		if(wordInfo) {
			resolve(wordInfo);
		} else {
			const errMsg = `Word '${word}' not found in database!`;
			throw errMsg;
			reject(errMsg);
		}
	} else {
		const errMsg = 'No word was specified! Could not find wordInfo in database';
		throw errMsg;
		reject(errMsg);
	}
	});
}

const buildSolutionMarkup = (wordInfo) => {
	return new Promise ((resolve, reject) => {
		if (wordInfo.char && wordInfo.word) {
			let modChar = modifyCharString(wordInfo);
			let	markup = `<div class="solution">
					<div class='solution-image'>${modChar}</div>
					<div class='solution-text correct'>${wordInfo.word}</div>
				</div>`;
			resolve (markup);
		} else {
			let errMsg = 'wordInfo did not have the necessary information';
			if(!wordInfo.word) {errMsg += ': \nword was not specified!';}
			if(wordInfo.word && !wordInfo.char) {errMsg += ` for '${wordInfo.word}' \nImage was not specified!`;}
			throw errMsg;
			reject (errMsg);
		}
	});
}



let solutionsDiv = document.getElementsByClassName('solutions')[0];


const renderWordbase = async (wb, targetElement) => {
	let promises = [];
	wb.forEach(entry => {
		promises.push(buildSolutionMarkup(entry));
	});

	const results = await Promise.allSettled(promises);
	console.log(results);
	results.forEach(result => {
		if (result.status == 'fulfilled') {
			targetElement.insertAdjacentHTML('beforeend', result.value);
		} else {
			const err = new Error(result.reason);
			console.error(err);
		}
	});

	let randomIncorrect = Math.floor((results.length)*Math.random());
	let solutionTexts = targetElement.getElementsByClassName('solution-text');
	solutionTexts[randomIncorrect].classList.remove('correct');
	solutionTexts[randomIncorrect].classList.add('incorrect');
	solutionTexts[randomIncorrect].parentNode.classList.add('selected-incorrect');

}

renderWordbase(wordbase, solutionsDiv).catch(err => console.log(err));

</script>
</body>
</html>
